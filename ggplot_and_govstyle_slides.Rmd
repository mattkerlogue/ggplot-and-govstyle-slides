---
output:
  xaringan::moon_reader:
    css: ["default", "coslide.css", "coslide-fonts.css"]
    seal: false
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
---

class: title-slide, middle, right

.title-text[ggplot and govstyle]

.title-sub[Making charts in R]

.title-spacer[]

.title-presenter[Matt Kerlogue]

.title-date[04 October 2019]

---

# Introducing ggplot

.pull-left[
[ggplot](https://ggplot2.tidyverse.org/) is an extensive visualisation package for R.

Created and curated as part of the [tidyverse](https://www.tidyverse.org), *but* it uses **+** rather than **%>%** to join elements.

The best way to think about constructing a `ggplot` is as a series of additive layers.
]

--
.pull-right[
```{r, eval=FALSE}
ggplot(data, aes(x = groups, y = value)) +
```
]

---

# Introducing ggplot

.pull-left[
[ggplot](https://ggplot2.tidyverse.org/) is an extensive visualisation package for R.

Created and curated as part of the [tidyverse](https://www.tidyverse.org), *but* it uses **+** rather than **%>%** to join elements.

The best way to think about constructing a `ggplot` is as a series of additive layers.
]

.pull-right[
```{r, eval=FALSE}
ggplot(data, aes(x = groups, y = value)) +
  geom_col()
```
]


---

# Introducing ggplot

.pull-left[
[ggplot](https://ggplot2.tidyverse.org/) is an extensive visualisation package for R.

Created and curated as part of the [tidyverse](https://www.tidyverse.org), *but* it uses **+** rather than **%>%** to join elements.

The best way to think about constructing a `ggplot` is as a series of additive layers.
]

.pull-right[
```{r, eval=FALSE}
ggplot(data, aes(x = groups, y = value)) +
  geom_col()
```

```{r, eval=FALSE}
ggplot(data, aes(x = groups, y = value)) +
  geom_col(fill = "blue") +
  coord_flip() +
  theme_gov()
```


]


---

# Introducing ggplot

.pull-left[
[ggplot](https://ggplot2.tidyverse.org/) is an extensive visualisation package for R.

Created and curated as part of the [tidyverse](https://www.tidyverse.org), *but* it uses **+** rather than **%>%** to join elements.

The best way to think about constructing a `ggplot` is as a series of additive layers.
]

.pull-right[
```{r, eval=FALSE}
ggplot(data, aes(x = groups, y = value)) +
  geom_col()
```

```{r, eval=FALSE}
ggplot(data, aes(x = groups, y = value)) +
  geom_col(fill = "blue") +
  coord_flip() +
  theme_gov()
```


1. Initate the plot
1. Add plot layer(s) [geoms]
1. Add layout/theme

]

---

# First things first... your data

.pull-left[
Most of us are used to making charts in Excel and not being too bothered about whether our plot data is structured.

Creating graphs through code requires a bit more care and attention to the underlying structure of your data.

]

--

.pull-right[

```{r, eval=FALSE}
| Year   | CO     | DFT    | HMT    |
|--------|--------|--------|--------|
| 2016   | 50%    | 48%    | 56%    |
| 2017   | 54%    | 44%    | 59%    |
| 2018   | 47%    | 50%    | 62%    |
| 2019   | 53%    | 55%    | 57%    |
```

```{r, eval=FALSE}
| ID  | Name       | Maths | English | Science | Art |
|-----|------------|-------|---------|---------|-----|
| 001 | Lala       | A     | B       | B       | C   |
| 002 | Po         | B     | C       | B       | B   | 
| 003 | Dipsy      | B     | A       | C       | C   |
| 004 | TinkyWinky | C     | A       | B       | A   |
```


]

---

# First things first... your data

.pull-left[
The previous tables were "wide". `ggplot` works best with "long" data, especially if you want to visualise different groups.
]

--

.pull-right[

```{r, eval=FALSE}
| ID  | Class   | Grade |    | ID  | Class   | Grade |
|-----|---------|-------|    |-----|---------|-------|
| 001 | Maths   | A     |    | 003 | Maths   | B     |
| 001 | English | B     |    | 003 | English | A     |
| 001 | Science | B     |    | 003 | Science | C     |
| 001 | Art     | C     |    | 003 | Art     | C     |
| 002 | Maths   | B     |    | 004 | Maths   | C     |
| 002 | English | C     |    | 004 | English | A     |
| 002 | Science | B     |    | 004 | Science | B     |
| 002 | Art     | B     |    | 004 | Art     | A     |

```

]

---

# First things first... your data

.pull-left[
The previous tables were "wide". `ggplot` works best with "long" data, especially if you want to visualise different groups.
]

.pull-right[

```{r, eval=FALSE}
| ID  | Class   | Grade |    | ID  | Class   | Grade |
|-----|---------|-------|    |-----|---------|-------|
| 001 | Maths   | A     |    | 003 | Maths   | B     |
| 001 | English | B     |    | 003 | English | A     |
| 001 | Science | B     |    | 003 | Science | C     |
| 001 | Art     | C     |    | 003 | Art     | C     |
| 002 | Maths   | B     |    | 004 | Maths   | C     |
| 002 | English | C     |    | 004 | English | A     |
```

``` {r, eval=FALSE}
| Class   | PercentA |
|---------|----------|
| Maths   | 25%      |
| English | 50%      |
| Science |  0%      |
| Art     | 25%      |
```

]


---

# Second things second... remember layers

---

![](https://66.media.tumblr.com/16c5cdbfb34827365a1c7f884eabd3fd/ce8844e5c94f39b5-45/s1280x1920/01796eaf666d47b4738050a22e8ec2a54c574d45.png)

---

# Second things second... remember layers

.pull-left[`ggplot` is additive, when you read/write `+` in your code think of it as 'and then'. And, always use a new line after the `+`.

This way you'll remember that each layer builds on the previous one.]

--

.pull-right[
```{r, eval=FALSE}
ggplot(data, aes(x = groups, y = value)) +
  geom_line(colour = "red") +
  geom_col(fill = "blue") +
  coord_flip() +
  theme_gov()
```
]

---

# Second things second... remember layers

.pull-left[`ggplot` is additive, when you read/write `+` in your code think of it as 'and then'. And, always use a new line after the `+`.

This way you'll remember that each layer builds on the previous one.]

.pull-right[
```{r, eval=FALSE}
ggplot(data, aes(x = groups, y = value)) +
  geom_line(colour = "red") +  #<<
  geom_col(fill = "blue") +    #<<
  coord_flip() +
  theme_gov()
```

Here the columns will be drawn after, and over the top of, the line. Is that really what we want to do?
]

---

# The data we'll be using


.pull-left[
We'll be using the Cabinet Office's [FOI Statistics (Q2 2019 release)](https://www.gov.uk/government/statistics/freedom-of-information-statistics-april-to-june-2019). Specifically, the [published data](https://www.gov.uk/government/uploads/system/uploads/attachment_data/file/831758/foi-statistics-q2-2019-published-data.csv/preview) csv.
]

.pull-right[
![](imgs/foi_stats_q2_q2019_cover.png)
]


---
``` {r, include=FALSE}

library(tidyverse)
library(DT)

raw_data <- suppressMessages(suppressWarnings(read_csv("https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/831758/foi-statistics-q2-2019-published-data.csv") %>%
  janitor::clean_names()))

```

```{r echo=TRUE, results='hide'}

# raw_data <- read_csv("https://assets.publishing.service.gov.uk/government/
#                       uploads/system/uploads/attachment_data/file/831758/
#                       foi-statistics-q2-2019-published-data.csv") %>% 
#               janitor::clean_names()

data <- raw_data %>%
  select(quarter, government_body, total_requests_received, total_resolvable_requests,
         starts_with("initial_outcome")) %>%
    mutate(acronym = map_chr(str_extract_all(government_body, "[A-Z]"), ~paste0(., collapse = "")))
```

``` {r, echo=FALSE}
glimpse(data)
```

---

``` {r}
gdat <- data %>% 
  filter (quarter == "Q2 2019", total_requests_received >100) %>%
  arrange(total_requests_received)

gdat
```

---

.pull-left[

``` {r, eval=FALSE}
ggplot()
```
]

.pull-right[
``` {r, echo=FALSE}
ggplot()
```
]

---

.pull-left[
``` {r, eval=FALSE}
ggplot(gdat)
```
]

.pull-right[
``` {r, echo=FALSE}
ggplot(gdat)
```
]

---

.pull-left[
``` {r, eval=FALSE}
ggplot(gdat) +
  geom_col(aes(x = acronym, 
               y = total_requests_received))
```
]

.pull-right[
``` {r, echo=FALSE}
ggplot(gdat) +
  geom_col(aes(x = acronym, y = total_requests_received))
```
]

---

.pull-left[
``` {r, eval=FALSE}
ggplot(gdat) +
  geom_col(aes(x = reorder(acronym,
                           -total_requests_received), 
               y = total_requests_received)) +
  
```
]

.pull-right[
``` {r, echo=FALSE}
ggplot(gdat) +
  geom_col(aes(x = reorder(acronym, -total_requests_received),
               y = total_requests_received))
```
]

